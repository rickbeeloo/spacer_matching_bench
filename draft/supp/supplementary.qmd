---
title: "Supplementary Material for: Computational Tool Choice Impacts CRISPR Spacer-Protospacer Detection"
author:
  - name: Uri Neri
    affiliations:
      - name: DOE Joint Genome Institute
        address: Berkeley, CA, USA
    email: uneri@lbl.gov
    corresponding: true
  - name: Antonio Pedro Camargo
    affiliations:
      - name: DOE Joint Genome Institute
        address: Berkeley, CA, USA
  - name: Brian Bushnell
    affiliations:
      - name: DOE Joint Genome Institute
        address: Berkeley, CA, USA
  - name: Simon Roux
    affiliations:
      - name: DOE Joint Genome Institute
        address: Berkeley, CA, USA
format:
  html:
    toc: true
    toc-depth: 3
    number-sections: true
  pdf:
    documentclass: article
    geometry:
      - margin=1in
    fig-format: pdf
    embed-resources: true
    keep-tex: true
    include-in-header:
      text: |
        \usepackage{float}
        \floatplacement{figure}{H}
        \usepackage{booktabs}
        \usepackage{colortbl}
        \usepackage[table]{xcolor}
        \definecolor{light-gray}{gray}{0.9}
        \renewcommand{\arraystretch}{1.2}
        \let\oldtabular\tabular
        \let\oldendtabular\endtabular
        \renewenvironment{tabular}{\small\oldtabular}{\oldendtabular}
        \setlength{\tabcolsep}{4pt}
    fig-pos: 'H'
    number-sections: true
    cite-method: biblatex
    pdf-engine: xelatex
    css: pdf_styles.css
  odt: default
  docx: default
---
# Supplementary Materials
## Tables 

### 1. Tool Configuration Details

For full version and build information see the git repo at [code.jgi.doe.gov/spacersdb/spacer_matching_bench](https://code.jgi.doe.gov/spacersdb/spacer_matching_bench)

**Note on tool versions:** Following reviewer suggestions, we added three tools to the benchmark compared to the initial version: Sassy (exhaustive edit distance search), X-mapper (dynamic gapped x-mer approach), and indelfree.sh (BBTools suite, both bruteforce exhaustive mode and indexed heuristic mode). We also updated versions of existing tools where newer releases were available.

**Note on BLASTn parameters:** The parameters for BLASTn were specifically chosen to enable the highest possible recall for short spacers. We used `blastn-short` (sets word-size at 7, compared to 11 with default blastn and 28 in megablastn), a very high number of max target sequences (`-max_target_seqs 1000000`, allowing up to 1M reported alignments per query compared to default value of 500), the `--ungapped` flag (used by CRISPRTarget, aligns with our hamming distance focus), and `perc_identity=84` and `qcov_hsp_perc=80`. The ungapped flag considerably reduced total CPU time. The perc_identity and qcov_hsp_perc arguments control output size - we cannot restrict blastn to a specific "n" distance, so these values allow a range of distances to be reported. For example, 85% identity over at least 80% of the spacer allows for 3 mismatches for a 20bp spacer (20 * 0.15 = 3), but allows more for a 30bp spacer (30 * 0.15 = 4.5). This range exceeds our desired threshold to capture all valid matches.

| Tool | Version | Command |
|:------------------- |:---------------------------------------- |:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |


### 2. Recall values for each tool at different mismatch thresholds 
#### A. IMG/VR4 dataset  
Every row lists the results for a specific mismatch threshold and tool.  
The values are for exact mismatches (not max), and represent the total number of unique spacer-contig pairs (aligning at that mismatch threshold).  
The fraction is tool_matches divided by total_possible.  


| mismatches | tool          | total_possible | tool_matches | fraction       |
|------------|---------------|----------------|--------------|----------------|
  

#### B. Synthetic dataset   



# Figures 

### Supplementary figure 1.

Benchmarking framework pipeline overview. 

![](figures/supp/workflow.svg)  


### Supplementary figure 2.

IMG/VR v4 based results in a tool vs tool comparison. Unlike the similar matrix in the main text(figure 1) which showcases the values for up to 1 and 3 mismatches, here the matrixes are separated for each mismatch threshold at an **exact** mismatch value. From top left to bottom right, the mismatch threshold is 0, 1, 2, 3. Like the main text figure, the value of a cell(i,j) is the fraction of spacer-contig pairs identified by the tool listed in row i, which were not identified by the tool listed in the j column.  


![](figures/supp/real_data_matrix_combined.svg)  


### Supplementary figure 3

Simulated dataset performance metrics.  
Precision = True Positives / (True Positives + False Positives)  
Recall = True Positives / (True Positives + False Negatives)  
F1 = 2 * (Precision * Recall) / (Precision + Recall)  
Note: Because of the various prefiltering steps, the number of False Negatives and False Positives may not be indicative of the actual raw tool-reported results. As such, we recommend focusing on the recall rate between tools, which is equivalent to the fraction of detected spacer-protospacer pairs out of all the spacer-protospacer pairs in the reference file.

![](figures/supp/simulated_tool_performance_by_mismatches.svg)


### Supplementary figure 4.

**Simulated dataset** recall (detection fraction) for different values of spacer occurrences.   

#### A. for exact mismatches, in a contig dependent manner
 Per contigs manner means the that the recall measure is the fraction of occurences each tool identified out of the total number of spacer-contig pairs, identified by all tools.  
1. 0 mismatches  

![](figures/supp/simulated_recall_vs_occurrences_with_contig_id_exact_nm_0.svg)  

2. exactly 1 mismatch  

![](figures/supp/simulated_recall_vs_occurrences_with_contig_id_exact_nm_1.svg)  

3. exactly 2 mismatches  

![](figures/supp/simulated_recall_vs_occurrences_with_contig_id_exact_nm_2.svg)  

4. exactly 3 mismatches  

![](figures/supp/simulated_recall_vs_occurrences_with_contig_id_exact_nm_3.svg)  

#### B. up to 1 and 3 mismatches, in a contig independent manner  

Per contig independent manner means that the recall measure is the fraction of occurences each tool identified out of the total number of times the spacer occurs in the reference file (regardless of in which contig).  
1. up to 1 mismatches

![](figures/supp/simulated_recall_vs_occurrences_max_nm_1.svg)  

2. up to 3 mismatches

![](figures/supp/simulated_recall_vs_occurrences_max_nm_3.svg)  


### Supplementary figure 5.

Tool recall versus occurrence frequency for **IMG/VR4 dataset**.  
Similar to main text figure, except for exact values for different mismatch thresholds (0-3).  

#### A. 0 mismatches    

![](figures/supp/real_data_recall_vs_occurrences_exact_nm_0.svg) 

#### B. 1 mismatch  

![](figures/supp/real_data_recall_vs_occurrences_exact_nm_1.svg)

#### C. 2 mismatches  

![](figures/supp/real_data_recall_vs_occurrences_exact_nm_2.svg)

#### D. 3 mismatches  

![](figures/supp/real_data_recall_vs_occurrences_exact_nm_3.svg)


### Supplementary figure 6.
Distributions of spacers characteristics.  
(A) Spacer size (length in bp)  
(B) Mismatches observed in spacer alignments  
(C) Spacer occurrence rate.

#### 1. IMG/VR4 dataset  

**Note:** the horizontal axis is logarithmic.    


![](figures/supp/real_data_spacer_distributions.svg)

#### 2. Synthetic dataset
  

![](figures/supp/simulated_spacer_distributions.svg)

### Supplementary figure 7.
Upset plot of tool performance for IMG/VR4 dataset. 
The panels (from top to bottom) are sorted by number of mismatches. The sets in each panel are sorted from left to right by the set size. Each row in each panel represents a tool, and the vertical lines connecting the dots indicate the intersection of the connected tool results'.  

#### A. 0 mismatches    

![](figures/supp/upset_0.svg)   

#### B. 1 mismatch     

![](figures/supp/upset_1.svg)  
  
#### C. 2 mismatches  

![](figures/supp/upset_2.svg)    

#### D. 3 mismatches   

![](figures/supp/upset_3.svg)  




supplementary note nnn: Coordinate Tolerance Matching Example
To illustrate the necessity for this coordinate tolerance matching, consider the following case from our synthetic dataset where three different tools detected the same biological match but reported slightly different coordinates:

| Source | Spacer ID | Contig ID | Query Start | Query End | Target Start | Target End | Strand | Mismatches/Cost (tool - reported) | Notes |
|:-------|:-------|:-------|-------:|-------:|-------:|-------:|:-------|-------:|:-------|
| Ground Truth | 1c47e31b_spacer_10034 | 1c47e31b_contig_1828 | \- | \- | 5001 | 5036 | reverse | 1 |  |
| BLASTn | 1c47e31b_spacer_10034 | 1c47e31b_contig_1828 | 1 | 34 | 5036 | 5003 | reverse | 0 |  |
| MMseqs2 | 1c47e31b_spacer_10034 | 1c47e31b_contig_1828 | 1 | 35 | 5036 | 5002 | reverse | 1 |  |
| Sassy | 1c47e31b_spacer_10034 | 1c47e31b_contig_1828 | \- | \- | 5000 | 5036 | reverse | 1 | CIGAR: 34=1I1= |

In this example, BLASTn reports the ungapped alignment at contig positions 5003-5036 (0 reported mismatches), MMseqs2 reports 5002-5036 (1 reported mismatch over the terminal base), and Sassy reports 5000-5036 (1 reported insertion, suggesting the position 5000 in the contig matches that of the last position in the spacer). The ground truth planned occurrence was at 5001-5036. Despite these coordinate variations, all three tools detected the same biological match. 
Critically, all three alignment regions are acceptable matches to the ground truth occurrence, under a maximum hamming distance of 1. 